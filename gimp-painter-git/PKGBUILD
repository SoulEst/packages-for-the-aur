# This is an example PKGBUILD file. Use this as a start to creating your own,
# and remove these comments. For more information, see 'man PKGBUILD'.
# NOTE: Please fill out the license field for your package! If it is unknown,
# then please put 'unknown'.

# Contributor: Nolan Haynes nolanhaynes@gmail.com
# Maintainer: Nolan Haynes nolanhaynes@gmail.com
pkgname=gimp-painter-git
pkgver=2.8.2392d45
pkgrel=1
epoch=
pkgdesc="A fork of GIMP with added features, new tools, and a different interface"
arch=('i686' 'x86_64')
url="http://sourceforge.jp/projects/gimp-painter/"
license=('GPL' 'LPGL')
groups=()
depends=('gtk2>2.24.10' 'lcms2>=2.2' 'libwmf>=0.2.8' 'webkitgtk2>=1.6.1' \
         'librsvg>=2.16.1' 'libpng>=1.2.27' 'fontconfig>=2.2.0' 'desktop-file-utils' \
	 'libexif>=0.6.15' 'libart-lgpl>=2.3.19' 'pygtk>=2.10.4' 'dbus-glib' 'gtk-doc' \
         'gegl-git' 'openexr>=1.6.1' 'cairo>=1.12.2' 'python2' 'hicolor-icon-theme')
makedepends=('gutenprint>=5.0.0' 'intltool>=0.40.1' 'libgtkhtml>=2.6.3' \
	     'gnome-python>=2.16.2' 'poppler>=0.12.4' 'pkgconfig>=0.21' \
	     'alsa-lib>=1.0.0' 'libtool>=2.2' 'autoconf>=2.54' 'automake=1.14' \
             'libxslt' 'pango>=1.29.4' 'curl>=7.15.1' 'gettext' 'git')
checkdepends=()
optdepends=('gutenprint: for sophisticated printing only as gimp has built-in cups print support'
            'poppler-glib: for pdf support'
            'alsa-lib: for MIDI event controller module'
            'curl: for URI support'
            'ghostscript: for postscript support')
provides=('gimp')
conflicts=('gimp' 'gimp-devel' 'gimp-devel-light' 'gimp-git' 'gimp-painter')
replaces=()
backup=()
options=('!libtool' '!makeflags')
install=gimp-painter-git.install
changelog=
source=(git://git.sourceforge.jp/gitroot/gimp-painter/gimp-painter-2.7.git
        linux.gpl)
noextract=()
md5sums=('SKIP'
         'bb27bc214261d36484093e857f015f38')

_gitname=gimp-painter-2.7

pkgver() {
	cd $_gitname
	GITREV=$(git describe --always|awk -F"-" '{print $NF}')
	echo `date +%Y%m%d`.${GITREV}
}

build() {
	cd "$srcdir/$_gitname"

    PYTHON=/usr/bin/python2 ./autogen.sh --prefix=/usr --sysconfdir=/etc \
    --enable-mp --enable-gimp-console --enable-gimp-remote \
    --enable-python --with-gif-compression=lzw --with-libcurl \
    --without-aa --without-hal --without-gvfs --without-gnomevfs

	make
}

package() {
  cd "$srcdir/$_gitname"
  make DESTDIR="$pkgdir/" install
  sed -i 's|#!/usr/bin/env python|#!/usr/bin/env python2|' "${pkgdir}"/usr/lib/gimp/2.0/plug-ins/*.py
  install -D -m644 "${srcdir}/linux.gpl" "${pkgdir}/usr/share/gimp/2.0/palettes/Linux.gpl"

  ln -s gimp-2.8 ${pkgdir}/usr/bin/gimp
  ln -s gimp-console-2.8 ${pkgdir}/usr/bin/gimp-console
}
